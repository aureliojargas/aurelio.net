#!/usr/bin/env python
#
# as-tidyhtml.py
#   A quick Python script to tidy the HTML code generated by the
#   "Convert Script to Markup Code" program. It changes all the
#   <font> tags to <span> and uses CSS for formating. The result
#   is a smaller file and the appearence is more similar to the
#   Script Editor's view.
# 
# Note: Don't check the CSS option on the program preferences.
#
# by Aurelio Marinho Jargas on May 8, 2005. Public Domain.
# http://aurelio.net/bin/as

import sys, re

if len(sys.argv) != 2:
	print "usage: %s file.html" % sys.argv[0]
	sys.exit()
else:
	htmlfile = sys.argv[1]
	outfile = htmlfile + '-tidy.html'

CSSRULES = """
<style type="text/css">
body { font-family: Verdana, Geneva, Courier, Sans-Serif; font-size: 85%; }
.comment  { color: gray ; font-style: italic; }
.variable { color: green; }
.command  { color: blue ; font-weight: bold; }
.keyword  { color: blue ; }
</style>
"""

replace_table = [
# CSS
('(</head>)', CSSRULES+"\\1"),
# spaces
('<font size="-1" face="Verdana, Geneva, Courier, Sans-Serif"> </font>', ' '),
# comments
('<font color="gray" size="-1" face="Verdana-Italic, Geneva, Courier, Sans-Serif">(.*?)</font>', '<span class="comment">\\1</span>'),
# comments
('<font size="-1" face="Verdana, Geneva, Courier, Sans-Serif">((&#160;)*--)</font>','<span class="comment">\\1</span>'),
# string and other
('<font size="-1" face="Verdana, Geneva, Courier, Sans-Serif">(.*?)</font>', '\\1'),
# variables
('<font color="green" size="-1" face="Verdana, Geneva, Courier, Sans-Serif">(.*?)</font>', '<span class="variable">\\1</span>'),
# commands
('<font color="blue" size="-1" face="Verdana-Bold, Geneva, Courier, Sans-Serif">(.*?)</font>', '<span class="command">\\1</span>'),
# keywords
('<font color="blue" size="-1" face="Verdana, Geneva, Courier, Sans-Serif">(.*?)</font>', '<span class="keyword">\\1</span>'),
]


# read file
txt = open(htmlfile, 'r').read()
# replace
for patt, rplc in replace_table: txt = re.sub(patt, rplc, txt)
# write file
fd = open(outfile, 'w').write(txt)

print "wrote", outfile

# vim: tw=0
