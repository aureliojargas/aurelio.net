<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<!--
  	****************************************************************
	***                                                          ***
	***   DO NOT EDIT THIS FILE IN MS WORD, use Notepad          ***
	***   More info at http://aurelio.net/projects/moneylog          ***
	***                                                          ***
	***   NÃO EDITE ESTE ARQUIVO NO WORD, use o Bloco de Notas   ***
	***   Mais informações em http://aurelio.net/moneylog        ***
	***                                                          ***
	****************************************************************

MoneyLog Experience ³
=====================

	MoneyLog Experience is a one-file finances reporter.

	O MoneyLog Experience é um gerador de extratos em um único arquivo.

Author/Autor:
 	Aurelio Jargas (www.aurelio.net)

History/Histórico:
 	v1: Jun-Jul 2006
 	v2: Jan-Feb 2007 (english version on May/2007)
 	v3: Oct-Dec 2007

License/Licença:
	BSD - http://en.wikipedia.org/wiki/BSD_license

-->

<head><title>$$$</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Vim">
<meta name="author" content="Aurelio Marinho Jargas www.aurelio.net">
<meta name="keywords" content="Personal Finance, KISS, Simple, HTML, CSS, Javascript">
<meta name="description" content="MoneyLog Experience - Personal finances management made real simple. In one single editable text file you have all your transactions and the engine to query it. Alter with any text editor and view the reports on the browser. Made with HTML, CSS and Javascript.">

<!--
All the page formatting is here.
You may change the styles if you know what you're doing.
-->
<style type="text/css">

body { color:#555; background-color:#fff; margin:0; padding:0; border:0; overflow:scroll; font-size:85%; font-family:sans-serif }
a { text-decoration:none; font-weight:bold }
#toolbar { color:#ddd; background-color:#444; text-align:center; z-index:1; position:fixed; top:0; left:0; width:100%; height:6em; padding-top:.3em }
#toolbar a { float:left; color:#c6f; font-variant:small-caps; font-size:185%; padding:0 4px }
#toolbar a:hover { background-color:#c6f; color:#444 }
#toolbar a.helplink { float:right }
#toolbar #filterbox { float:right; text-align:left }
#checkboxes { width:20em; margin:auto; text-align:left }
#content { z-index:0; margin-top:5em }
#tagsArea { float:left; background-color:#eee; padding:1.5em 0.5em 0.5em 0.5em; border:1px solid #ccc; border-width:0 1px 1px 0; Xmin-width:10%; display:none }
#tagsArea p { margin:0.5em 0; padding:0 }
#tagsArea input { margin:0; padding:0 }
#tagsArea #tagMultiAll { padding-left:0.3em }
#tagsArea #tagList { Xclear:both; padding-right:1em }
#report { text-align:center; padding:3em 0 }
#help { background-color:#edf; color:#515; padding:2em; margin:0; display:none }
#data { display:none }
table { margin:0 auto; border-spacing:0; border-collapse:collapse }
td { border:1px solid #ccc; padding:.1em 10px; font-size:85% }
td.row-count { text-align:center; font-size:70%; color:#aaa; border-width:0; background-color:#fff }
td.date { white-space:nowrap }
tr.future td.row-count { font-style:normal }
th { text-align:center; font-size:85%; cursor:pointer }
th:hover { color:#000; background-color:#eee }
tr:hover td { background-color: #edf }
tr.future { background-color:#eee; font-style:italic }
tr.average { background-color:#f8e8ff; font-style:italic }
tr.monthtotal { background-color:#f8e8ff; line-height:200%; text-align:right }
tr.monthtotal td { border-width:0; font-size:100% }
.trigger { cursor:pointer }
.number { text-align:right; white-space:nowrap }
.neg { color:#e33 }
tr.monthtotal td td.mini { font-size:75%; color:#868 }
table.monthsubtotal { margin:0 }
table.monthsubtotal td { padding:0; width:5.5em }

/* Emulating position:fixed in IE/Win 5+ */
#toolbar { _position:absolute; _top:expression(eval(document.body.scrollTop)) }

</style>

<script type="text/javascript">
/*********************************************************************
* User Config
* -----------
*
* There is no need to change *anything*, but if you have special
* needs, here is the place to customize this script.
*
*********************************************************************/
// Program interface
var lang = 'pt';                  // 'pt' or 'en' for Portuguese or English
var maxLastMonths = 12;           // Number of months on the last months combo
var initLastMonths = 3;           // Initial value for last months combo
var defaultOverview = false;      // Init in Overview mode?
var defaultLastMonths = false;    // Last months combo inits checked?
var defaultMonthPartials = true;  // Monthly checkbox inits checked?
var defaultRegex = false;         // Search regex checkbox inits checked?
var defaultNegate = false;        // Search negate checkbox inits checked?
var defaultSearch = '';           // Search for this text on init
var showRowCount = true;          // Show the row numbers at left?
var monthlyRowCount = true;       // The row numbers are reset each month?
// Data format
var dataFieldSeparator = '\t';
var dataRecordSeparator = /[\n\r]+/;
var dataTagTerminator = '|';
var dataTagSeparator = ',';
var commentChar = '#';   // Must be at line start (column 1)
// Screen Labels
if (lang == 'pt') {
	var labelOverview = 'Relatório Geral';
	var labelLastMonths = 'Somente Recentes:';
	var labelMonthly = 'Mostrar Parciais Mensais';
	var labelNoData = 'Nenhum lançamento.';
	var labelsDetailed = ['Data','Valor','Tags','Descrição'];
	var labelsOverview = ['Mês','Ganhos','Gastos','Saldo','Acumulado'];
	var labelAverage = 'Média';
	var labelMonths = ['mês', 'meses'];
	var labelRegex = ['regex'];
	var labelNegate = ['excluir'];
	var centsSeparator = ',';
	var thousandSeparator = '.';
} else {
	var labelOverview = 'Overview';
	var labelLastMonths = 'Recent Only:';
	var labelMonthly = 'Show Monthly Partials';
	var labelNoData = 'No data.';
	var labelsDetailed = ['Date','Amount','Tags','Description'];
	var labelsOverview = ['Month','Incoming','Expense','Partial','Balance'];
	var labelAverage = 'Average';
	var labelMonths = ['month', 'months'];
	var labelRegex = ['regex'];
	var labelNegate = ['negate'];
	// Screen separators (Inside data both , and . are handled automatically)
	var centsSeparator = '.';
	var thousandSeparator = ',';
}
// End of user Config


var sortColIndex = 0;
var sortColRev = false;
var oldSortColIndex;
var currentDate;
var overviewData = [];

if (!Array.prototype.push) { // IE5...
	Array.prototype.push = function(item) {
		this[this.length] = item; return this.length; }
}
if (!Number.prototype.toFixed) { // IE5...
	Number.prototype.toFixed = function(n) { // precision hardcoded to 2
		var k = (Math.round(this * 100) / 100).toString();
		k += (k.indexOf('.') == -1)? '.00' : '00';
		return k.substring(0, k.indexOf('.') + 3); }
}
String.prototype.strip = function() {
	return this.replace(/^\s+/, '').replace(/\s+$/, '');
}
Array.prototype.hasItem = function(item) {
	for (var i = 0; i < this.length; i++) {
		if (item == this[i]) { return true; }
	}
	return false;
}
Array.prototype.removePattern = function(patt) {
	cleaned = [];
	for (var i = 0; i < this.length; i++) {
		if (this[i] != patt) { cleaned.push(this[i]); }
	}
	return cleaned;
}

function sortCol(index, isOverview) { // if the same, flip reverse state
	sortColRev = (sortColIndex == index) ? sortColRev ^= true : false;
	sortColIndex = index;
	showReport();
}
function sortArray(a,b)  {
	a = a[sortColIndex]; b = b[sortColIndex];
	try {
		if (sortColIndex == 2) { a = a.toLowerCase(); b = b.toLowerCase(); }
	} catch(e) { }
	try { // IE6...
		if (a < b) { return -1; } else if (a > b) { return 1; }
	} catch(e) { }
	return 0;
}
function setCurrentDate() {
	var z = new Date();
	var m = z.getMonth()+1, d = z.getDate();
	m = (m < 10) ? '0'+m : m; d = (d < 10) ? '0'+d : d;
	currentDate = z.getFullYear() +'-'+ m +'-'+ d;
}
function getPastMonth(months) {
	var z = new Date();
	var m = z.getMonth()+1 - months; // zero based
	var y = z.getFullYear();
	if (m < 1) { m = 12 + m; y = y - 1; } // past year
	m = (m < 10) ? '0'+m : m;
	return y + '-' + m + '-' + '00';
}
function prettyFloat(num, noHtml) {
	var myClass = (num < 0) ? 'neg' : 'pos';
	num = num.toFixed(2).replace('.', centsSeparator);
	while (thousandSeparator && num.search(/[0-9]{4}/) > -1) {
		num = num.replace(/([0-9])([0-9]{3})([^0-9])/,
			'$1'+thousandSeparator+'$2$3');
	}
	return (noHtml) ? num : '<span class="'+myClass+'">'+num+'<\/span>';
	// Note: all html *end* tags have the / escaped to pass on validator
}
function populateMonthsCombo() {
	var el = document.getElementById('lastmonths');
	var label = labelMonths[0];
	for (var i=1; i <= maxLastMonths; i++) {
		if (i > 1) { label = labelMonths[1]; }
		el.options[i-1] = new Option(i + ' '+label, i);
	}
	el.selectedIndex = (initLastMonths > 0) ? initLastMonths-1 : 0;
}
function getTotalsRow(total, monthTotal, monthNeg, monthPos) {
	if (monthTotal) {
		var partial = new Array();
		partial.push('<table class="monthsubtotal number" align="right"><tr>');
		partial.push('<td class="mini"> +');
		partial.push(prettyFloat(monthPos, true) + '<br>');
		partial.push(prettyFloat(monthNeg, true) + '<\/td>');
		partial.push('<td>' + prettyFloat(monthTotal) + '<\/td>');
		partial.push('<\/tr><\/table>');
		partial = partial.join('');
	} else {
		var partial = '';
	}
	var theRow = '<tr class="monthtotal">';
	if (showRowCount) {
		theRow += '<td class="row-count"><\/td>';
	}
	theRow += '<td><\/td>';
	theRow += '<td class="number">'+prettyFloat(total)+'<\/td>';
	theRow += '<td colspan="2">'+partial+'<\/td><\/tr>';
	return theRow;
}
function getOverviewRow(theMonth, monthPos, monthNeg, monthTotal, theTotal) {
	var theRow = new Array();
	theRow.push((theMonth <= currentDate.slice(0,7)) ? '<tr>' : '<tr class="future">');
	theRow.push('<td>'+theMonth+'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(monthPos)  +'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(monthNeg)  +'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(monthTotal)+'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(theTotal)  +'<\/td>');
	theRow.push('<\/tr>');
	return theRow.join('\n');
}
function getOverviewAverageRow(avgPos, avgNeg, avgTotal) {
	var theRow = new Array();
	theRow.push('<tr class="average">');
	theRow.push('<td>'+labelAverage+'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(avgPos)  +'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(avgNeg)  +'<\/td>');
	theRow.push('<td class="number">'+prettyFloat(avgTotal)+'<\/td>');
	theRow.push('<td><\/td>');
	theRow.push('<\/tr>');
	return theRow.join('\n');
}
function toggleMonthly() {
	if (document.getElementById('optmonthly').checked == true) {
		sortColIndex = 0;
		sortColRev = false;
	}
	showReport();
}
function toggleHelp() {
	var el = document.getElementById('help');
	el.style.display = (el.style.display == 'block') ? 'none' : 'block';
}
function toggleOverview() {
	// When active, hide all the controls from the toolbar and also the tags
	if (document.getElementById('optoverview').checked == true) {
		document.getElementById('filterbox'      ).style.visibility = 'hidden';
		document.getElementById('optmonthly'     ).style.visibility = 'hidden';
		document.getElementById('optmonthlylabel').style.visibility = 'hidden';
		document.getElementById('tagsArea'       ).style.display = 'none';
		oldSortColIndex = sortColIndex; // save state
		sortColIndex = 0; // Default by date
	} else {
		document.getElementById('filterbox'      ).style.visibility = '';
		document.getElementById('optmonthly'     ).style.visibility = '';
		document.getElementById('optmonthlylabel').style.visibility = '';
		document.getElementById('tagsArea'       ).style.display = 'block';
		sortColIndex = oldSortColIndex;
		overviewData = [];
	}
	showReport();
}
function toggleLastMonths() {
	overviewData = [];
	showReport();
}
function lastMonthsChanged(elem) {
	document.getElementById('optlastmonths').checked = true;
	overviewData = [];
	showReport();
}
function readData() {
	var temp;
	var isRegex = false;
	var isNegated = false;
	var filter = '';
	var firstDate = 0;
	var rowDate, rowAmount, rowText;
	var rowTagsDescription, rowTags, rowDescription;
	var theData = new Array();
	var rawData = document.getElementById('data').innerHTML.split(dataRecordSeparator);

	if (document.getElementById('optlastmonths').checked) {
		firstDate = getPastMonth(document.getElementById('lastmonths').value-1);
	}
	
	// Get filters data for the detailed report
	if (!document.getElementById('optoverview').checked) {
		filter = document.getElementById('filter').value;
		isRegex = document.getElementById('optregex').checked;
		isNegated = document.getElementById('optnegate').checked;
	}
	
	// Prepare filter contents as /regex/ or string, always ignore case
	if (filter) {
		if (isRegex) {
			filter = eval('/'+filter.replace('/', '\\/')+'/i');
		} else {
			filter = filter.toLowerCase();
		}
	}

	// Scan data rows
	for (var i = 0; i < rawData.length; i++) {

		// Skip commented rows
		if (rawData[i].indexOf(commentChar) == 0) continue;
		// Skip rows with no separator
		if (rawData[i].indexOf(dataFieldSeparator) == -1) continue;
		
		// Filter firewall - Will this line pass it?
		if (filter) {
			if (isRegex) {
				filterPassed = filter.test(rawData[i]);
			} else {
				filterPassed = (rawData[i].toLowerCase().indexOf(filter) != -1);
			}
			if ((!filterPassed && !isNegated) || (filterPassed && isNegated)) continue;
		}

		// Parse row data
		temp = rawData[i].split(dataFieldSeparator);
		while (temp.length < 3) { temp.push(''); } // Force 3 items
		rowDate   = temp[0];
		rowAmount = temp[1] || '0';
		rowText   = temp[2].strip();
		
		// Normalize Date
		rowDate = rowDate.replace(/[^0-9-]/, '') || '-';
		if (rowDate < firstDate) continue; // last N months

		// Normalize Value (force '.' as scale separator)
		rowAmount = parseFloat(rowAmount.replace(/[.,]([0-9][0-9])$/, '@$1'
			).replace(/[^0-9@+-]/g, ''
			).replace('@', '.'));

		// Normalize Description/Tags
		if (rowText.indexOf(dataTagTerminator) != -1) {
			// Get tags
			// FIXME: Can't handle more than one separator
			rowTagsDescription = rowText.split(dataTagTerminator);
			rowTags        = rowTagsDescription[0].split(dataTagSeparator);
			rowDescription = rowTagsDescription[1].strip();
			
			// Strip all tags
			for (var j = 0; j < rowTags.length; j++) {
				rowTags[j] = rowTags[j].strip();
			}
			rowTags = rowTags.removePattern('');
		} else {
			rowTags = [];
			rowDescription = rowText || '&nbsp;';
		}
		
		// Save the parsed data
		theData.push([rowDate, rowAmount, rowTags, rowDescription]);
	}
	
	return theData;
}
function applyTags(theData) {
	// This function composes the full tag menu and
	//also filters theData if some tag is selected
	
	var rowTags;
	var tagCount, tagElement;
	var tagsMenu = [];
	var selectedTags = [];
	var filteredData = [];
	
	// Get multiple selection mode (true=AND, false=OR)
	var tagMultiAll = document.getElementById('tagMultiAllCheck').checked;
	
	// Get currently selected tags (from interface)
	try {
		tagCount = document.getElementById('tagCount').value;
		for (var i = 1; i <= tagCount; i++) {
			tagElement = document.getElementById('tag_'+i);
			if (tagElement && tagElement.checked) {
				selectedTags.push(tagElement.value);
			}
		}
	} catch(e) { }
	
	// Filter data to match current tags
	for (var i = 0; i < theData.length; i++) {
		
		// rowDate, rowAmount, rowTags, rowDescription
		rowTags = theData[i][2];
		
		// Populate tags array with UNIQUE row tags
		for (var j = 0; j < rowTags.length; j++) {
			if (!tagsMenu.hasItem(rowTags[j])) {
				tagsMenu.push(rowTags[j]);
			}
		}

		// Tag Filter is active. This line matches it?
		if (selectedTags.length > 0) {
		
			for (var j = 0; j < selectedTags.length; j++) {

				var thisTag = selectedTags[j];
				var tagMatched = (rowTags.hasItem(thisTag) ||
					(thisTag == ' ' && rowTags.length == 0));
					// Tip: space means no tag
				
				if (tagMatched && (!tagMultiAll)) break; // OR
				if (!tagMatched && (tagMultiAll)) break; // AND
			}
			if (tagMatched) {
				filteredData.push(theData[i]);
			}
		}
	}
	
	// Make sure the menu has all the selected tags
	for (var i = 0; i < selectedTags.length; i++) {
		if (!tagsMenu.hasItem(selectedTags[i]) && selectedTags[i] != ' ') {
			tagsMenu.push(selectedTags[i]);
		}
	}

	// Compose the tags menu HTML code (if we have at least one tag)
	if (tagsMenu.length > 0) {
		
		// Sorted tags are nice
		tagsMenu.sort();
		// Add a last ' ' item to match the rows with no tag
		tagsMenu.push(' ');
		
		// Save the total tag count
		document.getElementById('tagCount').value = tagsMenu.length;
		
		// Add one checkbox for each tag
		for (var i = 0; i < tagsMenu.length; i++) {
			tagName = tagsMenu[i];
			tagId = 'tag_' + (i+1)
			
			// Selected tags remain selected
			checked = selectedTags.hasItem(tagName) ? 'checked="checked"' : ''
			
			// The ugly code (but better than DOM-walking nightmares)
			tagsMenu[i] = '<input type="checkbox" class="trigger" onClick="showReport()" ' +
				checked + ' id="'+tagId+'" value="'+tagName+'">'+
				'<span class="trigger" onClick="document.getElementById(\''+tagId+'\').click()">&nbsp;'+tagName+'<\/span>';
		}

		// One tag per line
		tagsMenu = tagsMenu.join('<br>\n');
	}
	
	// Save the tags menu (or make it empty)
	document.getElementById('tagList').innerHTML = tagsMenu;
	
	// Show the tags menu if we have at least one tag
	document.getElementById('tagsArea').style.display = (
		tagsMenu.length > 0) ? 'block' : 'none';

	// The '+' checkbox is only shown if we have multiple selected tags
	document.getElementById('tagMultiAll').style.display = (
		selectedTags.length > 1) ? 'inline' : 'none';

	// Tag filter was active?
	if (selectedTags.length > 0) {
		return filteredData;
	} else {
		return theData;
	}
}
function showOverview() {
	var theData, thead, thisMonth, results = [];
	var theTotal = 0, monthTotal = 0, monthPos = 0, monthNeg = 0;
	var sumPos = 0, sumNeg = 0, sumTotal = 0;
	var currSortIndex = sortColIndex;

	// Table headings
	thead = '<th onClick="sortCol(0, true)">'+labelsOverview[0]+'<\/th>';
	thead+= '<th onClick="sortCol(1, true)">'+labelsOverview[1]+'<\/th>';
	thead+= '<th onClick="sortCol(2, true)">'+labelsOverview[2]+'<\/th>';
	thead+= '<th onClick="sortCol(3, true)">'+labelsOverview[3]+'<\/th>';
	thead+= '<th onClick="sortCol(4, true)">'+labelsOverview[4]+'<\/th>';

	if (!overviewData.length) { // Data not cached
		theData = readData();
		sortColIndex = 0; // Always scan by date order
		theData.sort(sortArray);
	}

	if (overviewData.length || theData.length) {
		results.push('<table>');
		results.push('<tr>' + thead + '<\/tr>');

		if (!overviewData.length) { // Scan and calculate
			for (var i = 0; i < theData.length; i++) {
				rowDate        = theData[i][0];
				rowAmount      = theData[i][1];
				// rowTags        = theData[i][2];
				// rowDescription = theData[i][3];
				
				if (i == 0) { thisMonth = rowDate.slice(0,7); }
				if (i > 0 &&
					rowDate.slice(0,7) !=
					theData[i-1][0].slice(0,7)) { //new month
					overviewData.push([thisMonth, monthPos, monthNeg, monthTotal, theTotal]);
					monthTotal = 0;
					monthPos = 0;
					monthNeg = 0;
					thisMonth = rowDate.slice(0,7);
				}
				theTotal += rowAmount;
				monthTotal += rowAmount;
				if (rowAmount < 0) {
					monthNeg += rowAmount;
				} else {
					monthPos += rowAmount;
				}
			}
			overviewData.push([thisMonth, monthPos, monthNeg, monthTotal, theTotal]);
		}
		sortColIndex = currSortIndex;
		overviewData.sort(sortArray);
		if (sortColRev) { overviewData.reverse(); }
		for (var i = 0; i < overviewData.length; i++) { // Array2Html
			z = overviewData[i];
			sumPos   += z[1];
			sumNeg   += z[2];
			sumTotal += z[3];
			results.push(getOverviewRow(z[0], z[1], z[2], z[3], z[4]));
		}
		var len = overviewData.length;
		results.push(getOverviewAverageRow(sumPos/len, sumNeg/len, sumTotal/len));
		results.push('<\/table>');
		results = results.join('\n');
	}
	else {
		results = labelNoData;
	}
	document.getElementById('report').innerHTML = results;
}

function showDetailed() {
	var thead;
	var theTotal = 0, monthTotal = 0;
	var monthPos = 0, monthNeg = 0;
	var rowCount = 0;
	var results = [];
	
	var monthPartials = document.getElementById('optmonthly');
	var theData = applyTags(readData());
	
	if (theData.length > 0) {

		// Data sorting procedures
		if (sortColIndex != 0 || sortColRev) {
			monthPartials.checked = false;
		}
		theData.sort(sortArray);
		if (sortColRev) { theData.reverse(); }

		// Compose table headings
		thead = '<th onClick="sortCol(0)">' + labelsDetailed[0] + '<\/th>';
		thead+= '<th onClick="sortCol(1)">' + labelsDetailed[1] + '<\/th>';
		thead+= '<th onClick="sortCol(2)" class="tags">' + labelsDetailed[2] + '<\/th>';
		thead+= '<th onClick="sortCol(3)">' + labelsDetailed[3] + '<\/th>';
		if (showRowCount) {
			thead = '<th class="row-count"><\/th>' + thead;
		}
		results.push('<table>');
		results.push('<tr>' + thead + '<\/tr>');

		// Compose table rows
		for (var i = 0; i < theData.length; i++) {
			
			rowDate        = theData[i][0];
			rowAmount      = theData[i][1];
			rowTags        = theData[i][2];
			rowDescription = theData[i][3];
			rowCount      += 1;
			
			// This row starts a new month? Must we show the partials?
			if (monthPartials.checked && i > 0 &&
				rowDate.slice(0,7) !=
				theData[i-1][0].slice(0,7)) {
				results.push(getTotalsRow(theTotal, monthTotal, monthNeg, monthPos));
				// Partials row shown, reset month totals
				monthTotal = 0;
				monthPos = 0;
				monthNeg = 0;
				if (monthlyRowCount) {
					rowCount = 1;
				}
			}
			
			// This row is in the future?
			if (rowDate <= currentDate) {
				results.push('<tr>');
			} else {
				results.push('<tr class="future">');
			}
			
			if (showRowCount) {
				results.push('<td class="row-count">'+ (rowCount) + '<\/td>');
			}
			
			results.push('<td class="date">'   + rowDate                + '<\/td>');
			results.push('<td class="number">' + prettyFloat(rowAmount) + '<\/td>');
			results.push('<td class="tags">'   + rowTags.join(', ')     + '<\/td>');
			results.push('<td>'                + rowDescription         + '<\/td>');
			results.push('<\/tr>');
				
			// Update totals
			theTotal += rowAmount;
			monthTotal += rowAmount;
			if (rowAmount < 0) {
				monthNeg += rowAmount;
			} else {
				monthPos += rowAmount;
			}
		}
		
		// Should we show the full month partials at the last row?
		if (monthPartials.checked) {
			results.push(getTotalsRow(theTotal, monthTotal, monthNeg, monthPos));
		} else {
			results.push(getTotalsRow(theTotal));
		}
		
		results.push('<\/table>');
		results = results.join('\n');

		// Real dirty hack to insert totals row at the table beginning (UGLY!)
		// results = results.replace('<\/th><\/tr>', '<\/th><\/tr>'+getTotalsRow(theTotal));
	}
	else {
		results = labelNoData;
	}
	document.getElementById('report').innerHTML = results;
}

function showReport() {
	if (document.getElementById('optoverview').checked) {
		showOverview();
	} else {
		showDetailed();
	}
}
function init() {
	setCurrentDate();
	populateMonthsCombo();
	
	// Lang-specific info
	document.getElementById('optoverviewlabel'  ).innerHTML = labelOverview;
	document.getElementById('optlastmonthslabel').innerHTML = labelLastMonths;
	document.getElementById('optmonthlylabel'   ).innerHTML = labelMonthly;
	document.getElementById('optregexlabel'     ).innerHTML = labelRegex;
	document.getElementById('optnegatelabel'    ).innerHTML = labelNegate;
	
	if (lang == 'pt') {
		var sitelink = document.getElementById('sitelink');
		sitelink.href = 'http://aurelio.net/moneylog';
		sitelink.title = 'Uma página. Um programa.'
		document.getElementById('help-en').style.display = 'none';
	} else {
		document.getElementById('help-pt').style.display = 'none';
	}
	
	// Apply user defaults
	if (defaultOverview)      { document.getElementById('optoverview'  ).click(); }
	if (defaultLastMonths)    { document.getElementById('optlastmonths').click(); }
	if (defaultMonthPartials) { document.getElementById('optmonthly'   ).click(); }
	if (defaultRegex)         { document.getElementById('optregex'     ).click(); }
	if (defaultNegate)        { document.getElementById('optnegate'    ).click(); }
	document.getElementById('filter').value = defaultSearch;
	
	showReport();
	// document.getElementById('filter').focus();
}
window.onload = init;
</script>

</head>

<body>

<div id="toolbar">
	<a id="sitelink" href="http://aurelio.net/projects/moneylog"
   	title="A webpage. A software.">MoneyLog<br>Experience ³</a>

	<a class="helplink" href="#" onClick="toggleHelp()">?</a>

   	<!-- Not using <form> to avoid action on Enter pressing -->
	<div id="filterbox">
		<input id="filter" size="15" type="text" onKeyUp="showReport()">
		<br>
		<input
			id="optregex" class="trigger" type="checkbox"
			onClick="showReport()"><span
			id="optregexlabel" class="trigger"
			onClick="document.getElementById('optregex').click()"></span>
		
		<input
			id="optnegate" class="trigger" type="checkbox"
			onClick="showReport()"><span
			id="optnegatelabel" class="trigger"
			onClick="document.getElementById('optnegate').click()"></span>
	</div>

	<div id="checkboxes">
		<!-- Overview -->
		<input
			id="optoverview" class="trigger" type="checkbox"
			onClick="toggleOverview()"><span
			id="optoverviewlabel" class="trigger"
			onClick="document.getElementById('optoverview').click()"></span>
		<br>
		
		<!-- Last Months -->
		<input
			id="optlastmonths" class="trigger" type="checkbox"
			onClick="toggleLastMonths()"><span
			id="optlastmonthslabel" class="trigger"
			onClick="document.getElementById('optlastmonths').click()"></span>
		<select
		 	id="lastmonths" size="1" onChange="lastMonthsChanged(this)"></select>
		<br>
	
		<!-- Monthly -->
		<input
		 	id="optmonthly" class="trigger" type="checkbox"
			onClick="toggleMonthly()"><span
			id="optmonthlylabel" class="trigger"
			onClick="document.getElementById('optmonthly').click()"></span>
	</div>
</div>

<div id="content">

	<div id="help">
	
	<div id="help-en">
	<p><strong>MoneyLog Experience ³</strong>:
	Track your finances the practical way. Think simple!
	<a href="http://aurelio.net/projects/moneylog/">Learn more...</a>
	<ul>
	<li><b>Overview :</b> Global summarized incoming, expenses and balance, by month.</li>
	<li><b>Recent Only:</b> See only the latest data, ignoring oldies.</li>
	<li><b>Show Monthly Partials</b> Shows the monthly balance, with sums of your incoming and expenses on the period.</li>
	<br>
	<li>
		<b>Search field:</b> Filter the reports in real time, as you type.
		<ul>
		<li><b>regex:</b> Use regular expressions on the search field.</li>
		<li><b>negate:</b> Remove the search results from the report.</li>
		</ul>
	</li>
	<li><b>Question mark:</b> Show/hide this help text.</li>
	<br>
	<li><b>Tags:</b> Choose the desired tags for the report: food, health, education, trip, ...</li>
	</ul>
	</p><p><strong>Tip:</strong>
	On the reports, click the column header to sort the results.
	Click again for reverse sorting.
	</p>
	</p><p><strong>Instructions:</strong>
	Save this page, use a plain text editor to add your own transactions and open it on the browser.
	</div>

	<div id="help-pt">
	<p><strong>MoneyLog Experience ³</strong>:
	Acompanhe suas finanças de maneira simples e prática. Descomplique!
	<a href="http://aurelio.net/moneylog">Saiba	mais...</a>
	<ul>
	<li><b>Relatório Geral:</b> Resumo de seus ganhos e gastos, com média e acumulado.</li>
	<li><b>Somente Recentes:</b> Veja somente os dados mais recentes, ignorando os antigos.</li>
	<li><b>Mostrar Parciais Mensais:</b> Mostra o saldo mensal e o acumulado, com somatórios de ganhos e gastos.</li>
	<br>
	<li>
		<b>Caixa de pesquisa:</b> Filtra os relatórios em tempo real, de acordo com o que você digita.
		<ul>
		<li><b>regex:</b> Usa <a href="http://aurelio.net/regex/">expressões regulares</a> na caixa de pesquisa.</li>
		<li><b>excluir:</b> Inverte o filtro, escondendo as transações pesquisadas.</li>
		</ul>
	</li>
	<li><b>Interrogação:</b> Mostra e esconde este texto de ajuda.</li>
	<br>
	<li><b>Tags:</b> Escolha que tipo de transações você quer ver: alimentação, saúde, educação, viagem, etc.</li>
	</ul>
	</p><p><strong>Dica:</strong>
	Nos relatórios, clique no título da coluna para mudar a ordenação.
	Clicando novamente a ordem é invertida.
	</p>
	</p><p><strong>Instruções:</strong>
	Salve esta página, use um editor de textos para colocar seus lançamentos
	e abra no navegador.
	</div>
	</div>

<div id="tagsArea">
	<p>Tags
		<span id="tagMultiAll">
		<input
		 	id="tagMultiAllCheck" type="checkbox" class="trigger"
			onClick="showReport()"><span
			class="trigger"
			onClick="document.getElementById('tagMultiAllCheck').click()">&nbsp;+</span>
		</span>
	</p>
	<div id="tagList">
	</div>
	<input type="hidden" id="tagCount" value="0">
</div>

<div id="report">
</div>

<noscript>
<p>Sorry. No Javascript detected, it won't work.</p>
<p>Ops! Seu navegador está sem Javascript, sem ele não vai funcionar.</p>
</noscript>

</div>

<pre id="data">
<!--
*******************************************************************
* English:                                                        *
*  - Put all your data below this box                             *
*  - Format:  YYYY-MM-DD  <tab>  Number  <tab>  Description       *
*  - Tags: Optional tags on Description: tag1,tag2|Description    *
*  - Tip: Escape special symbols: & < > becomes &amp; &lt; &gt;   *
*                                                                 *
* Português:                                                      *
*  - Coloque seu dados aqui embaixo                               *
*  - Formato:  AAAA-MM-DD  <tab>  Número  <tab>  Descrição        *
*  - Tags: Se quiser use tags na Descrição: tag1,tag2|Descrição   *
*  - Dica: Coloque os símbolos & < > como &amp; &lt; &gt;         *
*                                                                 *
******************************************************************* -->

# Troque estes dados pelos seus, separados por TAB
# Repito: separados por TAB, e não espaços em branco
# A data é no formato ANO-MES-DIA

2007-09-01	-100,00	Saldo inicial da conta :(
2007-09-07	-25,00	luz|
2007-09-07	-20,00	agua|
2007-09-15	-74,23	mercado|
2007-09-15	- 1,99	nerd| Prestação do mouse 10/12
2007-09-23	-39,90	presente, livro| Livro "Horóscopo dos Duendes"

2007-10-03	-142,59	presente| Um Shrubbery
2007-10-07	-20,00	luz|
2007-10-07	-17,80	agua|
2007-10-11	  5,00	Ganhei a aposta com o Zé
2007-10-12	-40,00	presente, nerd| Poster colorido 3D do Tux em Ascii Art
2007-10-15	- 1,99	nerd| Prestação do mouse 11/12
2007-10-29	-95,67	mercado|

2007-11-07	-29,00	luz|
2007-11-07	-32,37	agua|
2007-11-12	-199,90	presente| Segway usado no Mercado Livre
2007-11-15	- 1,99	nerd| Prestação do mouse 12/12 (acabou!)

2007-12-07	-25,00	luz|
2007-12-07	-30,00	agua|

# A ordem não importa, é possível deixar juntas as transações periódicas
2007-09-05	300,00	salario|
2007-10-05	300,00	salario|
2007-11-05	300,00	salario|
2007-12-05	300,00	salario|


# Pode usar linhas em branco e espaços indiscriminadamente
2007-11-20	   -    10,00	    Carnê do Baú

# Transações futuras! (comentado)
# 2009-12-31	+99,99	Bônus
