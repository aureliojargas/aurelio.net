#!/bin/bash
# Tidy all the HTML files for the site.
# See _scripts/html-tidy for details.

# Make sure we are at the repository root
cd $(dirname "$0")
cd ..

ignore="
# Skip files that have full <html> markup, they are not content-only
doc/coluna/coluna-09.html
doc/rdl/areas-compartilhadas.html
doc/rdl/poder-modo-texto.html

# Skip files that have comments (tidy removes them)
articles/applescript-install.html
articles/applescript-vs-python.html
articles/dropbox-iphoto-11.html
articles/dropbox-iphoto-import.html
articles/dropbox-selective-sync.html
articles/dropbox-symlinks.html
articles/hungry-sumo-high-scores.html
articles/index.html
articles/iphoto-symlinks.html
articles/shell-reference.html
doc/cv-aurelio.html
doc/faq.html

# Figures markup needs fix
doc/dort.html
doc/faq.html

# <blockquote> indented
doc/sem-mouse-HOWTO.html

# <dt> previous empty line removed
doc/sem-mouse-HOWTO.html

# --- are converted to ===
articles/dropbox-iphoto-import.html

# Manual formatting that I want to preserve
doc/irc-mar2005.html
articles/applescript-vs-python.html
aurelio/index.html

# Do not tidy index.html files that were auto generated by
# _scripts/generate-index. They use the 'ls' layout.
$(git grep -l '^layout: ls$')
"
ignore=$(echo "$ignore" | grep . | grep -v '^#')

find \
    articles \
    aurelio \
    doc \
    -type f \
    -name '*.html' |
    grep -vx -f <(echo "$ignore") |
    xargs -n 1 _scripts/html-tidy
